{"version":3,"sources":["../../src/server/Provider.js"],"names":["RequestClient","require","_getName","id","split","map","s","charAt","toUpperCase","slice","join","module","exports","uppy","opts","provider","authProvider","name","tokenKey","setAuthToken","token","localStorage","setItem","checkAuth","get","then","payload","authenticated","authUrl","hostname","fileUrl","list","directory","logout","redirect","location","href","res","removeItem","defaultHeaders","getItem"],"mappings":"AAAA;;;;;;;;;;;;AAEA,IAAMA,gBAAgBC,QAAQ,iBAAR,CAAtB;AACAA,QAAQ,cAAR;;AAEA,IAAMC,WAAW,SAAXA,QAAW,CAACC,EAAD,EAAQ;AACvB,SAAOA,GAAGC,KAAH,CAAS,GAAT,EAAcC,GAAd,CAAkB,UAACC,CAAD;AAAA,WAAOA,EAAEC,MAAF,CAAS,CAAT,EAAYC,WAAZ,KAA4BF,EAAEG,KAAF,CAAQ,CAAR,CAAnC;AAAA,GAAlB,EAAiEC,IAAjE,CAAsE,GAAtE,CAAP;AACD,CAFD;;AAIAC,OAAOC,OAAP;AAAA;;AACE,oBAAaC,IAAb,EAAmBC,IAAnB,EAAyB;AAAA;;AAAA,iDACvB,0BAAMD,IAAN,EAAYC,IAAZ,CADuB;;AAEvB,UAAKC,QAAL,GAAgBD,KAAKC,QAArB;AACA,UAAKZ,EAAL,GAAU,MAAKY,QAAf;AACA,UAAKC,YAAL,GAAoBF,KAAKE,YAAL,IAAqB,MAAKD,QAA9C;AACA,UAAKE,IAAL,GAAY,MAAKH,IAAL,CAAUG,IAAV,IAAkBf,SAAS,MAAKC,EAAd,CAA9B;AACA,UAAKe,QAAL,oBAA+B,MAAKf,EAApC;AANuB;AAOxB;;AAMD;AAdF,qBAeEgB,YAfF,yBAegBC,KAfhB,EAeuB;AACnB;AACAC,iBAAaC,OAAb,CAAqB,KAAKJ,QAA1B,EAAoCE,KAApC;AACD,GAlBH;;AAAA,qBAoBEG,SApBF,wBAoBe;AACX,WAAO,KAAKC,GAAL,CAAY,KAAKrB,EAAjB,kBACJsB,IADI,CACC,UAACC,OAAD,EAAa;AACjB,aAAOA,QAAQC,aAAf;AACD,KAHI,CAAP;AAID,GAzBH;;AAAA,qBA2BEC,OA3BF,sBA2Ba;AACT,WAAU,KAAKC,QAAf,SAA2B,KAAK1B,EAAhC;AACD,GA7BH;;AAAA,qBA+BE2B,OA/BF,oBA+BW3B,EA/BX,EA+Be;AACX,WAAU,KAAK0B,QAAf,SAA2B,KAAK1B,EAAhC,aAA0CA,EAA1C;AACD,GAjCH;;AAAA,qBAmCE4B,IAnCF,iBAmCQC,SAnCR,EAmCmB;AACf,WAAO,KAAKR,GAAL,CAAY,KAAKrB,EAAjB,eAA4B6B,aAAa,EAAzC,EAAP;AACD,GArCH;;AAAA,qBAuCEC,MAvCF,qBAuCoC;AAAA;;AAAA,QAA1BC,QAA0B,uEAAfC,SAASC,IAAM;;AAChC,WAAO,KAAKZ,GAAL,CAAY,KAAKrB,EAAjB,yBAAuC+B,QAAvC,EACJT,IADI,CACC,UAACY,GAAD,EAAS;AACbhB,mBAAaiB,UAAb,CAAwB,OAAKpB,QAA7B;AACA,aAAOmB,GAAP;AACD,KAJI,CAAP;AAKD,GA7CH;;AAAA;AAAA;AAAA,wBAUwB;AACpB,aAAO,SAAc,EAAd,EAAkB,yBAAME,cAAxB,EAAwC,EAAC,mBAAmBlB,aAAamB,OAAb,CAAqB,KAAKtB,QAA1B,CAApB,EAAxC,CAAP;AACD;AAZH;;AAAA;AAAA,EAAwClB,aAAxC","file":"Provider.js","sourcesContent":["'use strict'\n\nconst RequestClient = require('./RequestClient')\nrequire('whatwg-fetch')\n\nconst _getName = (id) => {\n  return id.split('-').map((s) => s.charAt(0).toUpperCase() + s.slice(1)).join(' ')\n}\n\nmodule.exports = class Provider extends RequestClient {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.provider = opts.provider\n    this.id = this.provider\n    this.authProvider = opts.authProvider || this.provider\n    this.name = this.opts.name || _getName(this.id)\n    this.tokenKey = `uppy-server-${this.id}-auth-token`\n  }\n\n  get defaultHeaders () {\n    return Object.assign({}, super.defaultHeaders, {'uppy-auth-token': localStorage.getItem(this.tokenKey)})\n  }\n\n  // @todo(i.olarewaju) consider whether or not this method should be exposed\n  setAuthToken (token) {\n    // @todo(i.olarewaju) add fallback for OOM storage\n    localStorage.setItem(this.tokenKey, token)\n  }\n\n  checkAuth () {\n    return this.get(`${this.id}/authorized`)\n      .then((payload) => {\n        return payload.authenticated\n      })\n  }\n\n  authUrl () {\n    return `${this.hostname}/${this.id}/connect`\n  }\n\n  fileUrl (id) {\n    return `${this.hostname}/${this.id}/get/${id}`\n  }\n\n  list (directory) {\n    return this.get(`${this.id}/list/${directory || ''}`)\n  }\n\n  logout (redirect = location.href) {\n    return this.get(`${this.id}/logout?redirect=${redirect}`)\n      .then((res) => {\n        localStorage.removeItem(this.tokenKey)\n        return res\n      })\n  }\n}\n"]}