{"version":3,"sources":["../../../src/plugins/Instagram/index.js"],"names":["Plugin","require","Provider","ProviderView","h","module","exports","uppy","opts","type","id","title","icon","serverUrl","provider","authProvider","files","onAuth","bind","render","defaultOptions","serverPattern","install","view","viewType","showTitles","showFilter","showBreadcrumbs","setPluginState","authenticated","folders","directories","activeRow","filterInput","isSearchVisible","target","mount","uninstall","tearDown","unmount","getFolder","getUsername","data","user","username","isFolder","item","getItemData","getItemIcon","images","low_resolution","url","getItemSubList","subItems","forEach","subItem","carousel_media","i","index","created_time","newSubItem","carousel_id","push","getItemName","ext","date","Date","toLocaleDateString","year","month","day","hour","minute","getMimeType","getItemId","getItemRequestPath","suffix","isNaN","getItemModifiedDate","getItemThumbnailUrl","thumbnail","getNextPagePath","getPluginState","length","state"],"mappings":"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","file":"index.js","sourcesContent":["const Plugin = require('../../core/Plugin')\nconst { Provider } = require('../../server')\nconst { ProviderView } = require('../../views')\nconst { h } = require('preact')\n\nmodule.exports = class Instagram extends Plugin {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'Instagram'\n    this.title = 'Instagram'\n    this.icon = () => (\n      <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"28\" height=\"28\" viewBox=\"0 0 512 512\">\n        <path d=\"M256,49.471c67.266,0,75.233.257,101.8,1.469,24.562,1.121,37.9,5.224,46.778,8.674a78.052,78.052,0,0,1,28.966,18.845,78.052,78.052,0,0,1,18.845,28.966c3.45,8.877,7.554,22.216,8.674,46.778,1.212,26.565,1.469,34.532,1.469,101.8s-0.257,75.233-1.469,101.8c-1.121,24.562-5.225,37.9-8.674,46.778a83.427,83.427,0,0,1-47.811,47.811c-8.877,3.45-22.216,7.554-46.778,8.674-26.56,1.212-34.527,1.469-101.8,1.469s-75.237-.257-101.8-1.469c-24.562-1.121-37.9-5.225-46.778-8.674a78.051,78.051,0,0,1-28.966-18.845,78.053,78.053,0,0,1-18.845-28.966c-3.45-8.877-7.554-22.216-8.674-46.778-1.212-26.564-1.469-34.532-1.469-101.8s0.257-75.233,1.469-101.8c1.121-24.562,5.224-37.9,8.674-46.778A78.052,78.052,0,0,1,78.458,78.458a78.053,78.053,0,0,1,28.966-18.845c8.877-3.45,22.216-7.554,46.778-8.674,26.565-1.212,34.532-1.469,101.8-1.469m0-45.391c-68.418,0-77,.29-103.866,1.516-26.815,1.224-45.127,5.482-61.151,11.71a123.488,123.488,0,0,0-44.62,29.057A123.488,123.488,0,0,0,17.3,90.982C11.077,107.007,6.819,125.319,5.6,152.134,4.369,179,4.079,187.582,4.079,256S4.369,333,5.6,359.866c1.224,26.815,5.482,45.127,11.71,61.151a123.489,123.489,0,0,0,29.057,44.62,123.486,123.486,0,0,0,44.62,29.057c16.025,6.228,34.337,10.486,61.151,11.71,26.87,1.226,35.449,1.516,103.866,1.516s77-.29,103.866-1.516c26.815-1.224,45.127-5.482,61.151-11.71a128.817,128.817,0,0,0,73.677-73.677c6.228-16.025,10.486-34.337,11.71-61.151,1.226-26.87,1.516-35.449,1.516-103.866s-0.29-77-1.516-103.866c-1.224-26.815-5.482-45.127-11.71-61.151a123.486,123.486,0,0,0-29.057-44.62A123.487,123.487,0,0,0,421.018,17.3C404.993,11.077,386.681,6.819,359.866,5.6,333,4.369,324.418,4.079,256,4.079h0Z\" />\n        <path d=\"M256,126.635A129.365,129.365,0,1,0,385.365,256,129.365,129.365,0,0,0,256,126.635Zm0,213.338A83.973,83.973,0,1,1,339.974,256,83.974,83.974,0,0,1,256,339.973Z\" />\n        <circle cx=\"390.476\" cy=\"121.524\" r=\"30.23\" />\n      </svg>\n    )\n\n    this[this.id] = new Provider(uppy, {\n      serverUrl: this.opts.serverUrl,\n      provider: 'instagram',\n      authProvider: 'instagram'\n    })\n\n    this.files = []\n\n    this.onAuth = this.onAuth.bind(this)\n    this.render = this.render.bind(this)\n\n    // set default options\n    const defaultOptions = {}\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n    this.opts.serverPattern = opts.serverPattern || opts.serverUrl\n  }\n\n  install () {\n    this.view = new ProviderView(this, {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false\n    })\n    // Set default state for Instagram\n    this.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      activeRow: -1,\n      filterInput: '',\n      isSearchVisible: false\n    })\n\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.view.tearDown()\n    this.unmount()\n  }\n\n  onAuth (authenticated) {\n    this.setPluginState({ authenticated })\n    if (authenticated) {\n      this.view.getFolder('recent')\n    }\n  }\n\n  getUsername (data) {\n    return data.data[0].user.username\n  }\n\n  isFolder (item) {\n    return false\n  }\n\n  getItemData (item) {\n    return item\n  }\n\n  getItemIcon (item) {\n    if (!item.images) {\n      return <svg viewBox=\"0 0 58 58\" opacity=\"0.6\">\n        <path d=\"M36.537 28.156l-11-7a1.005 1.005 0 0 0-1.02-.033C24.2 21.3 24 21.635 24 22v14a1 1 0 0 0 1.537.844l11-7a1.002 1.002 0 0 0 0-1.688zM26 34.18V23.82L34.137 29 26 34.18z\" /><path d=\"M57 6H1a1 1 0 0 0-1 1v44a1 1 0 0 0 1 1h56a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zM10 28H2v-9h8v9zm-8 2h8v9H2v-9zm10 10V8h34v42H12V40zm44-12h-8v-9h8v9zm-8 2h8v9h-8v-9zm8-22v9h-8V8h8zM2 8h8v9H2V8zm0 42v-9h8v9H2zm54 0h-8v-9h8v9z\" />\n      </svg>\n    }\n    return <img src={item.images.low_resolution.url} />\n  }\n\n  getItemSubList (item) {\n    const subItems = []\n    item.data.forEach((subItem) => {\n      if (subItem.carousel_media) {\n        subItem.carousel_media.forEach((i, index) => {\n          const { id, created_time } = subItem\n          const newSubItem = Object.assign({}, i, { id, created_time })\n          newSubItem.carousel_id = index\n          subItems.push(newSubItem)\n        })\n      } else {\n        subItems.push(subItem)\n      }\n    })\n    return subItems\n  }\n\n  getItemName (item) {\n    if (item && item['created_time']) {\n      const ext = item.type === 'video' ? 'mp4' : 'jpeg'\n      let date = new Date(item['created_time'] * 1000)\n      date = date.toLocaleDateString([], {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: 'numeric',\n        minute: 'numeric'\n      })\n      // adding both date and carousel_id, so the name is unique\n      return `Instagram ${date} ${item.carousel_id || ''}.${ext}`\n    }\n    return ''\n  }\n\n  getMimeType (item) {\n    return item.type === 'video' ? 'video/mp4' : 'image/jpeg'\n  }\n\n  getItemId (item) {\n    return `${item.id}${item.carousel_id || ''}`\n  }\n\n  getItemRequestPath (item) {\n    const suffix = isNaN(item.carousel_id) ? '' : `?carousel_id=${item.carousel_id}`\n    return `${item.id}${suffix}`\n  }\n\n  getItemModifiedDate (item) {\n    return item.created_time\n  }\n\n  getItemThumbnailUrl (item) {\n    return item.images.thumbnail.url\n  }\n\n  getNextPagePath () {\n    const { files } = this.getPluginState()\n    return `recent?max_id=${this.getItemId(files[files.length - 1])}`\n  }\n\n  render (state) {\n    return this.view.render(state)\n  }\n}\n"]}